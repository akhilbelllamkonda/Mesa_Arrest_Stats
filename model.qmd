--- 
title: Model
execute: 
  echo: false
---  
To analyze the factors associated with the likelihood of an arrest being made, we used a Bayesian Bernoulli regression model. The model aims to understand how subject sex and the date of the event influence the probability of an arrest. The formula used is:

arrest_made
âˆ¼
subject_sex
+
as.numeric(date)

```{r}
#| label: setup 
#| message: false 
#| warning: false
library(tidyverse)
library(brms)
library(tidybayes)
library(gtsummary)
library(broom.helpers)
library(lubridate)
library(broom.mixed)
library(gt)
library(kableExtra)
mesa_data <- read_csv('/Users/chittibellamkonda/Downloads/az_mesa_2023_01_26.csv')
  clean_data <- mesa_data |> mutate(
    date = as.Date(date, format = "%Y-%m-%d"), 
    year = year(date)  # Fixed misplaced 'date,' causing issues
  ) |>
  filter(!is.na(subject_sex))
  brm1 <- read_rds('data/brm1.rds')
```


```{r}
#| warning: false
brm1
```
The model is a Bayesian Bernoulli regression analyzing the likelihood of an arrest with predictors subject_sex and date. The logit link function is used. The dataset includes 154,640 observations, and the model was fit using 4 chains of 1000 iterations each. The intercept estimate is 3.20, suggesting the baseline log-odds of an arrest, while subject_sexmale has a coefficient of 0.76, indicating males have higher log-odds of arrest. The date predictor has a negligible effect on arrest likelihood. Convergence diagnostics (Rhat) are close to 1, showing good model fit.




```{r}
#| label: model 
#| cache: true 
#| warning: false
#df1 <- is.na(mesa_data)
#brm1 <- brm(data = clean_data, 
 #formula =  arrest_made ~ subject_sex + as.numeric(date),
#family = bernoulli(),
#silent = 2,
 # refresh = 0,
  #   iter = 1000,    # Set number of iterations (default is 2000)
   # chains = 4,     # Number of Markov Chains (default is 4)
    # seed = 13)
 #write_rds(brm1, "data/brm1.rds")

model_summary <- broom.mixed::tidy(brm1, conf.int = TRUE, conf.level = 0.95)

# Prepare data for the summary table
formatted_summary <- model_summary %>%
  dplyr::mutate(
    term = recode(term,
                  "(Intercept)" = "Intercept",
                  "subject_sexmale" = "Subject Sex (Male)",
                  "as.numericdate" = "Date"),
    `95% CI Lower` = conf.low,
    `95% CI Upper` = conf.high
  ) |>
  dplyr::select(term, estimate, `95% CI Lower`, `95% CI Upper`) %>%
  dplyr::rename(
    Beta = estimate,
    
  )


formatted_summary |>
  kable("html", caption = "Summary of Bernoulli Model Coefficients") %>%
  kable_styling(full_width = F, position = "center", bootstrap_options = c("striped", "hover", "condensed"))
```
Intercept: The estimate is 3.20 with a 95% credible interval ranging from -2.06 to 5.92. This value represents the baseline log-odds of an arrest when other predictors are at their reference levels.
Subject Sex (Male): The coefficient is 0.76 with a 95% credible interval from 0.48 to 1.37. This suggests that being male is associated with higher log-odds of an arrest compared to the reference category (female).
Date: The coefficient is -0.00 with a 95% credible interval from -0.00 to -0.00. This indicates a very slight decrease in the log-odds of an arrest with each passing day.
